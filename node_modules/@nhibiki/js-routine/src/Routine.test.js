const r = require("..");

// Check Task
r.Routine.Task(async () => {
    await r.Timer.Await(3000);
    return "OK";
}, null, 1000)().then(res =>{
    console.log(res);
}).catch(err => {
    if (err.error.code === r.Error.ERROR.TIMEOUT) console.log("Timeout");
});

// Check Timer Routine
let countUp = 0;
r.Routine.Routine(async function({currentTick}) {
    console.log(++countUp);
    if (currentTick > 3) this.terminate();
}, {tickIntv:1000, infinite:true}).start();

// Check Channel
let a = r.Routine.Routine(async function({waitFor, currentTick}) {
    let b = await waitFor("c");
    console.log(b, currentTick);
    this.terminate();
}).start();
a.passArg("c", "OK");

// Check Checker
let good = false;
let b = r.Routine.Routine(async function({watchFor, currentTick}) {
    let b = await watchFor(async () => {
        return !!good;
    });
    console.log(b, currentTick);
    this.terminate();
}).start();

setTimeout(() => {
    good = true;
}, 8000);